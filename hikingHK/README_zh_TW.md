# HikingHK 🏔️

專為香港行山愛好者設計的 iOS 行山伴侶應用程式，使用 SwiftUI 和 SwiftData 構建。

## 概述

HikingHK 是一個功能豐富的行山應用程式，旨在幫助行山愛好者探索、計劃和追蹤他們在香港美麗山徑上的冒險。應用程式提供實時天氣資訊、路線詳情、離線地圖、安全檢查清單、位置分享、行山追蹤和智能路線推薦。

## 功能特色

### 🏠 首頁
- **天氣儀表板**：來自香港天文台的實時天氣狀況
- **精選路線**：發現推薦的行山路線
- **快速操作**（每行 4 個按鈕）：
  - 🚨 路線警示 - 實時天氣和路線警告
  - 🗺️ 離線地圖 - 下載地圖供離線使用
  - 📍 位置分享 - 與緊急聯絡人分享您的位置
  - 🎯 開始追蹤 - 開始記錄您的行山
  - 📋 行山記錄 - 查看您的行山歷史
  - ✨ 智能推薦 - AI 驅動的路線建議
  - 📖 日記 - 記錄您的行山冒險
  - ☁️ 天氣預報 - 7 天天氣預報
- **即將計劃**：查看和管理您已安排的行程
- **安全檢查清單**：行山前的安全準備

### 🗺️ 路線
- **路線瀏覽器**：瀏覽 17+ 條香港行山路線
- **搜尋與篩選**：按名稱、地區或難度尋找路線
- **路線資料庫**：包含主要路線：
  - 麥理浩徑（第 1, 2, 3, 4, 5, 8 段）
  - 衛奕信徑（第 1, 2 段）
  - 鳳凰徑（第 2, 3 段）
  - 港島徑（第 1, 4 段）
  - 著名山峰：獅子山、大东山、蚺蛇尖、大帽山
  - 熱門路線：龍脊、山頂環回步行徑、大潭水塘
- **路線詳情**：
  - 互動地圖與路線視覺化
  - 離線地圖支援與網絡檢測
  - 檢查點和路線資訊
  - 設施和交通提示
  - 亮點和描述

### 📅 計劃
- **行程規劃**：安排您的行山行程
- **路線選擇**：從可用路線中選擇
- **備註**：添加集合點、裝備提醒和其他備註
- **日期管理**：設定和更新行山日期

### 👤 個人資料
- **帳戶管理**：安全的登入/登出認證
- **統計儀表板**：
  - 已計劃行程數
  - 收藏路線
  - 總記錄距離
- **目標追蹤**：
  - 完成 4 條山脊線（困難路線）
  - 本月記錄 50 公里
  - 進度條視覺化
- **成就與徽章**：追蹤您的行山成就
- **服務狀態**：監控天氣 API、GPS 和離線地圖的連接狀態
- **API 連接檢查器**：實時 API 連接狀態監控
- **語言選擇**：在英文和繁體中文之間切換

### 📖 日記
- **行山日記**：記錄您的行山冒險
- **照片支援**：為日記條目添加照片
- **路線關聯**：將日記條目連結到特定路線
- **天氣數據**：自動記錄天氣狀況
- **時間軸視圖**：按月瀏覽條目
- **編輯與刪除**：管理您的日記條目

### 🎯 智能推薦
- **AI 驅動建議**：獲得個人化路線推薦
- **基於時間**：選擇可用時間（從 1-8 小時，每 30 分鐘間隔）
- **基於偏好**：根據以下因素推薦：
  - 體能水平
  - 偏好風景（海景、山景、森林等）
  - 難度偏好
  - 距離偏好
- **天氣整合**：考慮當前天氣狀況
- **歷史學習**：從您的行山歷史中學習

### 📍 位置分享
- **實時分享**：與緊急聯絡人分享您的位置
- **SOS 功能**：一鍵緊急求救並發送位置
- **異常檢測**：自動檢測異常移動模式
- **緊急聯絡人**：管理您的緊急聯絡人列表
- **會話管理**：開始和停止分享會話

### 🎯 行山追蹤
- **GPS 追蹤**：實時記錄您的行山路線
- **統計數據**：追蹤距離、時間、速度和海拔
- **路線選擇**：將追蹤與特定路線關聯
- **實時地圖**：查看您當前的位置和路線
- **軌跡點**：詳細的 GPS 點記錄

### 📋 行山記錄
- **歷史視圖**：瀏覽所有記錄的行山
- **詳細統計**：查看全面的行山數據
- **路線視覺化**：在地圖上查看記錄的路線
- **海拔剖面**：查看行山期間的海拔變化
- **3D 回放**：以 3D 方式回放您的行山路線

### ☁️ 天氣預報
- **7 天預報**：延長天氣預測
- **最佳行山時間**：推薦最佳行山時段
- **舒適度指數**：天氣舒適度計算
- **狀況詳情**：溫度、濕度和天氣狀況

### 🎒 智能裝備清單
- **智能建議**：根據以下因素推薦裝備：
  - 路線難度
  - 天氣狀況
  - 季節
- **分類組織**：必需品、服裝、導航、安全、食物、工具
- **進度追蹤**：視覺進度指示器

### 🏆 成就
- **徽章系統**：在行山時解鎖成就
- **類別**：
  - 距離成就（10 公里、50 公里、100 公里、500 公里）
  - 山峰征服（獅子山、大帽山、大东山、蚺蛇尖）
  - 連續成就（1 週、2 週、1 個月）
  - 探索成就（3、5、10 個地區）
- **進度追蹤**：視覺進度指示器

## 技術架構

### 核心技術
- **SwiftUI**：現代聲明式 UI 框架
- **SwiftData**：持久化數據存儲
- **CoreLocation**：GPS 和位置服務
- **Combine**：響應式編程
- **MapKit**：地圖顯示和離線地圖支援
- **Network Framework**：網絡狀態監控

### 架構模式
- **MVVM 模式**：Model-View-ViewModel 架構
- **協議導向**：服務協議以提高可測試性
- **Async/Await**：現代並發處理網絡和數據操作
- **MainActor 隔離**：UI 更新的正確線程安全

### 數據模型
- `UserCredential`：用戶認證數據
- `SavedHikeRecord`：已計劃和完成的行程
- `FavoriteTrailRecord`：用戶收藏的路線
- `SafetyChecklistItem`：安全檢查清單項目
- `OfflineMapRegion`：離線地圖下載狀態
- `HikeRecord`：記錄的行山會話
- `HikeTrackPoint`：GPS 追蹤點
- `HikeJournal`：日記條目
- `JournalPhoto`：日記條目照片
- `EmergencyContact`：緊急聯絡人
- `LocationShareSession`：位置分享會話
- `UserPreference`：用戶推薦偏好
- `Achievement`：成就和徽章數據

## 安裝

### 系統要求
- iOS 17.0+
- Xcode 15.0+（已測試 Xcode 26.1）
- Swift 5.9+

### 設置步驟
1. 克隆倉庫：
```bash
git clone https://github.com/Charlieppy2/iosEa.git
cd iosEa/hikingHK
```

2. 在 Xcode 中打開專案：
```bash
open hikingHK.xcodeproj
```

3. 構建並運行專案（⌘R）

### 配置
- **Mapbox API**：設置 `MAPBOX_ACCESS_TOKEN` 環境變量以使用路線服務（可選）
- **位置服務**：應用程式會在需要時請求位置權限

## API 整合

### 天氣 API ✅
- **端點**：`https://data.weather.gov.hk/weatherAPI/opendata/weather.php?dataType=rhrread&lang={lang}`
- **狀態**：已連接
- **語言**：英文（`en`）和繁體中文（`tc`）
- **數據類型**：實時天氣讀數
- **功能**：溫度、濕度、UV 指數、天氣警告
- **更新頻率**：手動刷新或應用啟動時
- **連接檢查**：在個人資料 → API 狀態中可用
- **錯誤處理**：全面的錯誤處理和詳細日誌記錄

### 天氣警告 API ✅
- **端點**：`https://data.weather.gov.hk/weatherAPI/opendata/weather.php?dataType=warnsum&lang={lang}`
- **狀態**：已連接
- **語言**：英文（`en`）和繁體中文（`tc`）
- **功能**：活躍的天氣警告和警示

### CSDI 地理資訊平台 API ✅
- **端點**：
  - `https://portal.csdi.gov.hk/geoportal/?datasetId=afcd_rcd_1665568199103_4360&lang={lang}`
  - `https://portal.csdi.gov.hk/geoportal/?datasetId=afcd_rcd_1635136039113_86105&lang={lang}`
  - `https://portal.csdi.gov.hk/geoportal/?datasetId=cas_rcd_1640314527589_15538&lang={lang}`
- **狀態**：已連接
- **語言**：英文（`en`）和繁體中文（`zh-hk`）
- **功能**：路線資訊和政府數據

### Mapbox API ⚠️
- **端點**：`https://api.mapbox.com/directions/v5/mapbox/walking/`
- **狀態**：可選配置
- **要求**：需要 `MAPBOX_ACCESS_TOKEN` 環境變量
- **功能**：路線計算和導航
- **連接檢查**：在個人資料 → 數據與服務中可用

### API 連接監控
- 實時 API 狀態檢查
- 在個人資料頁面顯示連接狀態
- 手動刷新功能
- 最後檢查時間追蹤
- 詳細錯誤報告

## 本地化

應用程式完全支援兩種語言：
- **英文**（`en`）
- **繁體中文**（`zh-Hant` / `tc`）

所有 UI 元素、路線名稱、天氣狀況和錯誤訊息都已本地化。用戶可以在個人資料 → 語言中切換語言。

## 數據隱私

- 所有用戶數據使用 SwiftData 本地存儲
- 除以下情況外，不會將數據傳輸到外部服務器：
  - 天氣 API（公開數據）
  - 天氣警告 API（公開數據）
  - CSDI 地理資訊平台 API（公開數據）
  - Mapbox API（路線計算，可選）
- 用戶憑證經過加密並安全存儲
- 位置分享由用戶發起，可隨時停止

## 路線資料庫

應用程式目前包含 **17 條行山路線**，涵蓋：
- **麥理浩徑**：第 1, 2, 3, 4, 5, 8 段
- **衛奕信徑**：第 1, 2 段
- **鳳凰徑**：第 2, 3 段
- **港島徑**：第 1, 4 段
- **著名山峰**：獅子山、大东山、蚺蛇尖、大帽山
- **熱門路線**：龍脊、山頂環回步行徑、大潭水塘

> **注意**：香港有超過 300 條行山路線。應用程式目前包含主要路線。更多路線可在未來更新中添加。

## 離線地圖

- **下載區域**：
  - 香港島
  - 九龍山脊
  - 西貢東
  - 大嶼山北
- **功能**：
  - 下載進度追蹤
  - 存儲管理
  - 自動離線模式檢測
  - 網絡狀態監控
  - 地圖瓦片緩存

## 未來增強功能

- [ ] 擴展路線資料庫以包含所有 300+ 條香港路線
- [ ] 真實 AR 相機整合（使用 ARKit）
- [ ] 社交功能（分享行程、照片）
- [ ] 高級路線規劃（路徑點）
- [ ] Apple Health 整合
- [ ] 路線警示推送通知
- [ ] 社區評價和評分
- [ ] 路線照片庫
- [ ] 導出行程數據
- [ ] 連接官方路線資料庫 API

## 貢獻

歡迎貢獻！請隨時提交 Pull Request。

## 授權

本專案為私有和專有。

## 作者

為香港行山愛好者用心製作 ❤️

---

**注意**：本應用程式專為香港行山路線設計，使用本地 API 和服務。某些功能可能需要位置權限和互聯網連接。

## 相關文檔

- [FILE_STRUCTURE.md](FILE_STRUCTURE.md) - 文件結構說明
- [FEATURE_STATUS.md](FEATURE_STATUS.md) - 功能實現狀態和 API 連接檢查
- [TRAILS_LIST.md](TRAILS_LIST.md) - 完整路線列表

---

**語言**：[English](README.md) | [繁體中文](README_zh_TW.md)
